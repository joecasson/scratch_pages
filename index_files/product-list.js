!function(a,b){Ply.ui.define("range",{options:{second:null,steps:20,fillRange:true,allowCross:false,containerClass:"range",trackClass:"range-track",handleClass:"range-handle",inputClass:"range-input",fillClass:"range-fill",dragClass:"dragging",clickClass:"clicked",sizeToView:true,onchange:null,onmove:null},__objects:{},__init:function(){var f=this,e,d,g,c;f.max=parseFloat(f.view.attr("max")||"100");f.min=parseFloat(f.view.attr("min")||"0");f.step=parseFloat(f.view.attr("step")||""+((f.max-f.min)/f.options.steps));if(f.options.sizeToView){c=f.view.height();g=f.view.width()}f.objects.container=f.view.wrap(a("<div />").addClass(f.options.containerClass)).parent();if(f.options.sizeToView){f.objects.container.css({height:c,width:g})}f.objects.inputs=f.view;if(f.options.second){f.objects.container.append(f.options.second);f.objects.inputs=f.objects.inputs.add(f.options.second)}f.objects.track=a("<div />").addClass(f.options.trackClass);f.objects.container.append(f.objects.track);f.objects.handles=a();f.objects.inputs.each(function(j,k){var h=a("<div />").addClass(f.options.handleClass).data("index",j);f.objects.container.append(h);f.objects.handles=f.objects.handles.add(h);a(k).addClass(f.options.inputClass)});f.objects.fill=f.options.fillRange?a("<div />").addClass(f.options.fillClass):a();f.objects.track.append(f.objects.fill);f.handleCount=f.objects.handles.length;f.objects.handles.each(function(j){var i=a(this);f.setHandleValue(j,f.objects.inputs.eq(j).val()&&parseInt(f.objects.inputs.eq(j).val())>0?parseFloat(f.objects.inputs.eq(j).val()):j/(f.handleCount-1)*(f.max-f.min)+f.min)});f._events()},_events:function(){var e=this,d=a(window),c=a("body");e.objects.container.on("selectstart",function(f){f.preventDefault();return false});e.objects.handles.mousedown(function(g){var f=a(this),h=f.data("index"),j=g.screenX,i=f.position().left,k=[];e.objects.container.addClass(e.options.dragClass);f.addClass(e.options.clickClass);c.mousemove(function(l){e.setHandleValue(h,e.handlePosToVal(i+(l.screenX-j)))}).one("mouseup",function(l){c.off("mouseup mousemove");e.objects.container.removeClass(e.options.dragClass);if(e.options.onchange&&a.isFunction(e.options.onchange)){e.objects.inputs.each(function(){k.push(parseFloat(a(this).val()))});e.options.onchange(h,k)}})});d.resize(function(){e.objects.inputs.each(function(f){e.setHandleValue(f,parseFloat(a(this).val()))})})},handlePosToVal:function(c){var d=this,e=d.objects.container.width();return(c/e)*(d.max-d.min)+d.min},setHandleValue:function(f,k){var j=this,c=j.objects.handles.eq(f),e=j.objects.handles.not(c).first(),d=j.objects.inputs.eq(f),m=j.objects.container.width(),l=[],i,g,h;if(j.objects.handles.size()>1&&!j.allowCross){if(c.data("index")<e.data("index")){g=e.data("value")||j.max;h=j.min}else{g=j.max;h=e.data("value")||j.min}}else{g=j.max;h=j.min}if(k>g){k=g}if(k<h){k=h}if(j.step>0){k=Math.floor((k-j.min)/j.step)*j.step+j.min}d.val(k);i=(k-j.min)/(j.max-j.min)*m;c.css("left",i).data("value",k);if(f===0){j.objects.fill.css("left",i)}else{j.objects.fill.css("right",m-i)}if(j.options.onmove&&a.isFunction(j.options.onmove)){j.objects.inputs.each(function(){l.push(parseFloat(a(this).val()))});j.options.onmove(f,l)}}})}(jQuery);
(function(a,e){var d="grid-766-",c=a(window),b=a("html, body");Ply.ui.define("product_list",{__init:function(){var f=this;f._register();if(f.view&&f.view.size()>0){Ply.core.notify("measureExpandables",f.view,null)}f.events();if(f.options.pageurl==="/search"){Ply.read.add("getPage",f.options.pageurl)}else{Ply.read.add("getPage","/product/list")}Ply.read.add("getFacets",f.options.facetsurl);if(Modernizr.history){window.history.replaceState(f.data,null,null)}else{f.initialSettings=a.extend({},f.data)}f.loadAndFade()},__objects:{form:"#list-form",maxPrice:"#filter-sections #priceRange_max_",minPrice:"#filter-sections #priceRange_min_",priceRange:"#priceRange",priceLabels:".range-labels li",sortBox:"#sort",largeSizeSelect:"#large-size",smallSizeSelect:"#small-size",productList:"#product-list",facetsList:"#product-list-filters",filterSections:"#filter-sections",filters:"#filter-sections .filter-section",productHolder:"#products",products:"#product-list .product",header:"#product-list-info-header",overlay:"#product-list .loader-overlay",message:"#product-list .loader-message",content:"#product-list-content"},options:{url:"/product/list",pageurl:"/product/listpage",facetsurl:"/product/listfacets",loadingMessage:"Loading...",currencySymbol:"$"},data:{page:1,size:36,cols:4,sort:""},_register:function(){var f=this;Ply.ui.register("range",{view:f.objects.minPrice,options:{second:f.objects.maxPrice,onchange:function(g,h){f.objects.form.change()},onmove:function(g,h){f.objects.priceLabels.eq(g).text(f.options.currencySymbol+h[g].toFixed(0))}}})},events:function(){var f=this;f.objects.form.change(function(h,i){var g;f.updateSettings();if(a(h.target).attr("name")!==e){if(a(h.target).attr("name").match(/Filter.*/gi)){delete f.data["priceRange[min]"];delete f.data["priceRange[max]"]}}if(a(h.target).attr("name")==="cols"){f.objects.productHolder.get(0).className=d+f.data.cols;f.objects.products.removeClass("grid-item-first gird-item-last").each(function(k){var j=a(this);if(k%f.data.cols===0){j.addClass("grid-item-first")}else{if(k%f.data.cols===f.data.cols-1){j.addClass("grid-item-last")}}});g=f.objects.productHolder.find("img");g.filter(".main").each(function(){var j=a(this);a.preloadImg(j.data("fsrc").format(f.data.cols===3?250:187,0),function(k){j.attr("src",k)})});g.filter(".main").each(function(){var j=a(this);a.preloadImg(j.data("fsrc").format(f.data.cols===3?250:187,0),function(k){j.attr("src",k)})});f.createHistoryEntry(f.data)}else{f.fetchPage()}});f.objects.form.on("change","#product-list-filters input",function(g){f.data.page=1});f.objects.sortBox.on("change",function(g){});f.objects.productList.on("click",".data-pager a",function(i){var g=a(this),h=g.data(),j=h.page,k=h.size;i.preventDefault();f.data.page=j;f.data.size=k;f.objects.form.change()});f.objects.facetsList.on("click",".filter-section h5",function(g){a(this).parent().toggleClass("filter-section-open")});if(Modernizr.history){c.on("popstate",function(g){if(g.originalEvent.state){f.pushSettings(g.originalEvent.state);f.fetchPage(true)}})}else{c.on("hashchange",function(g){var h;if(!window.ignoreHashChange){if(window.location.hash.indexOf("#!")===0){h=a.queryStringToObject("?"+window.location.hash.split("?")[1])}else{if(window.location.search>""){h=window.location.queryString}else{h=f.initialSettings}}f.pushSettings(h);f.fetchPage(true)}window.ignoreHashChange=false})}},pushSettings:function(g){var f=this;f.data=g},updateSettings:function(){var g=this;g.data=a.extend(g.data||{},{sort:g.objects.sortBox.val(),cols:g.objects.largeSizeSelect.is(":checked")?3:4,"priceRange[min]":parseFloat(g.objects.minPrice.val()),"priceRange[max]":parseFloat(g.objects.maxPrice.val())});var f="";g.objects.filters.each(function(){var h=a(this),i,k,j,l;if(!h.is("[data-filtername]")){return}k="filters["+h.data("filtername")+"]";i=h.find('input[name="'+k+'"]:checked');j=Array.prototype.slice.call(i.map(function(m,n){return n.value}),0);if(j&&j.length>0){g.data[k]=j;dataLayer.push({facetedCategory:h.data("filtername").trim(),facetedFilter:j.toString().trim(),event:"facetedSearch"})}else{delete g.data[k]}})},fetchPage:function(i){var g=this,h=g.data,f;if(g.currentfetch&&g.currentfetch.abort){g.currentfetch.abort()}g.showLoader();b.animate({scrollTop:g.objects.content.position().top},500,"linear");g.currentfetch=Ply.read.getPage(h,function(j){g.currentfetch=null;g.objects.productList.html(j.Page);g.objects.facetsList.html(a(j.Filters).html());g.__bindObjects();if(g.view&&g.view.size()>0){Ply.core.notify("measureExpandables",g.view,null)}Ply.core.notify("styleSelects",g.objects.header,null);g._register();if(!i){g.createHistoryEntry(h)}g.loadAndFade()},function(j){if(j.statusText==="abort"){return}Ply.core.log("There was an error loading page "+g.data.page)})},createHistoryEntry:function(f){var g=a.createUrl(this.options.url,f);if(Modernizr.history){window.history.pushState(f,null,g)}else{window.ignoreHashChange=true;window.location.hash="#!"+g}},loadAndFade:function(){var g=this,f=true;if(g.objects.products.size()>0){g.objects.products.each(function(){var h=a(this);a.preloadImg(h.find("img").first().attr("src"),function(){if(f){g.objects.header.animate({opacity:1},"normal");g.hideLoader();f=false}h.animate({opacity:1},"normal")})})}else{g.hideLoader()}},showLoader:function(){var f=this;if(f.objects.overlay.is(":visible")){return}f.objects.overlay.fadeIn("normal");c.on("resize scroll",function(){var h=Math.max(f.objects.productList.offset().top,c.scrollTop())-f.objects.productList.offset().top,g=Math.min(f.objects.productList.offset().top+f.objects.productList.outerHeight(),c.scrollTop()+c.height())-f.objects.productList.offset().top;f.objects.message.css({position:"absolute",top:h+(g-h)/2-f.objects.message.outerHeight()/2,left:f.objects.overlay.outerWidth()/2-f.objects.message.outerWidth()/2})}).resize()},hideLoader:function(){var f=this;if(f.objects.overlay&&f.objects.overlay.size()>0){f.objects.overlay.fadeOut("normal",function(){c.off("resize scroll")})}}})})(jQuery);
